---
title: "Converting and translating country names"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{package_intro}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)

library(Countries)
```



## Installing and loading the package

Since the package is not yet on CRAN, it needs to be downloaded directly from the Github repository. This can be done with the `devtools` package.

```{r , eval=FALSE}
# Install and load devtools
install.packages("devtools")
library(devtools)

# Install and load Countries package
devtools::install_github("fbellelli/countries")
library(Countries)
```


## Dealing with country names

The function `country_name()` can be used to convert country names to different naming conventions or to translate them to different languages. 

```{r}
example <- c("United States","DR Congo", "Morocco")

# Getting 3-letters ISO code
country_name(x= example, to="ISO3")

# Translating to spanish
country_name(x= example, to="name_es")
```

If multiple arguments are passed to the argument `to`, the function will output a `data.frame` object, with one column corresponding to every naming convention.

```{r}
# Requesting 2-letter ISO codes and translation to Spanish and French
country_name(x= example, to=c("ISO2","name_es","name_fr"))
```


The `to` argument supports all the following naming conventions:




```{r echo=FALSE}
tab <- data.frame(CODE=c("**simple**","**ISO3**","**ISO2**","**ISO_code**","**UN_**xx","**WTO_**xx","**name_**xx","**GTAP**", "**all**"),
           DESCRIPTION=c("This is a simple english version of the name containing only ASCII characters. This nomenclature is available for all countries.",
                         "3-letter country codes as defined in ISO standard `3166-1 alpha-3`. This nomenclature is available only for the territories in the standard (currently 249 territories).",
           "2-letter country codes as defined in ISO standard `3166-1 alpha-2`. This nomenclature is available only for the territories in the standard (currently 249 territories).",
           "Numeric country codes as defined in ISO standard `3166-1 numeric`. This country code is the same as the UN's country number (M49 standard). This nomenclature is available for the territories in the ISO standard (currently 249 countries).",
           "Official UN name in 6 official UN languages. Arabic (`UN_ar`), Chinese  (`UN_zh`), English  (`UN_en`), French  (`UN_fr`), Spanish  (`UN_es`), Russian (`UN_ru`). This nomenclature is only available for countries in the M49 standard (currently 249 territories).",
           "Official WTO name in 3 official WTO languages: English (`WTO_en`), French (`WTO_fr`), Spanish (`WTO_es`). This nomenclature is only available for WTO members and observers (currently 189 entities).",
           "Translation of ISO country names in 28 different languages: Arabic (`name_ar`), Bulgarian (`name_bg`), Czech (`name_cs`), Danish (`name_da`), German (`name_de`), Greek (`name_el`), English  (`name_en`), Spanish  (`name_es`), Estonian (`name_et`),  Basque (`name_eu`),  Finnish (`name_fi`), French (`name_fr`), Hungarian (`name_hu`), Italian (`name_it`), Japponease (`name_ja`), Korean (`name_ko`), Lithuanian (`name_lt`), Dutch (`name_nl`), Norwegian (`name_no`), Polish (`name_po`), Portuguese (`name_pt`), Romenian (`name_ro`), Russian (`name_ru`), Slovak (`name_sk`), Swedish (`name_sv`), Thai (`name_th`), Ukranian (`name_uk`), Chinese simplified (`name_zh`), Chinese traditional (`name_zh-tw`)",
           "GTAP country and region codes.", "Converts to all the nomenclatures and languages in this table"))

knitr::kable(tab)
```





## Fuzzy matching and warning messages

`country_name()` can identify countries even when they are provided in mixed formats or in different languages. It is robust to small misspellings and recognises many alternative country names and old nomenclatures.  

```{r}
fuzzy_example <- c("US","C@ète d^Ivoire","Zaire","FYROM","Estados Unidos","ITA")

country_name(x= fuzzy_example, to=c("UN_en"))
```

More information on the country matching process can be obtained by setting ´verbose=TRUE´. The function will print information on:
* The number of unique strings provided by the user. In the example below 6 distinct country names strings have been provided.
* How many country names correspond exactly to the ones in the function's reference list and how many have been recognised with fuzzy matching. In the example below, `"C@ète d^Ivoire"` is the only name recognised with fuzzy matching. The function's reference table can be accessed with the command ´data(country_reference_list)´.
* The function prints summary statistics on fuzzy matching. The DISTANCE metric refers to the number of insertions, deletions or substitutions necessary to go from the provided string (´"C@ète d^Ivoire"´) to the closest reference (´"Côte d'Ivoire"´). Lower DISTANCE statistics indicate more reliable fuzzy matching.  


```{r}
country_name(x= fuzzy_example, to=c("UN_en"), verbose=TRUE)

#
country_name(x= "slélakd", to=c("UN_en"), verbose = TRUE, fuzzy_match = TRUE)
```

In addition, setting ´verbose=TRUE´ will also print additional informations relating  to specific warnings.:
* If multiple strings have been matched to the same country, the function will signal it to the user (´Multiple country IDs have been matched to the same country name´). In the example above, both ´"US"´ and ´"Estados Unidos"´ are matched to the same country. If the vector of country names is a unique identifier, this could indicate that some country name was not recognised correctly (see next section on how to use use custom tables).
* If ´fuzzy_match´is set to ´FALSE´, the function will print all the strings for which no exact match was found. The user might consider using ´fuzzy_match=TRUE´ or custom tables (see next section) to match strings that are not recognised exactly. 
  + Finally, if the closest element in the function's reference list is very different to the provided string, the function will flag it to the user  is matched to 

## Using custom conversion tables

```{r}
data(country_reference_list)

#match_table()
```

